---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
filename <-
  jsonlite::read_json(".//data-raw/saved/China--2021-03-23-15-19-13.json")
```
```{r}
filename %>%
  get_event_times() %>%
  select(fc_time_start,sc_time_start, drop_time) %>%
  select(`First Crack` = fc_time_start, `Second crack` = sc_time_start, `Roast time` = drop_time) %>%
  mutate_if(is.POSIXct, format, format = "%M:%S") %>%
  pivot_longer(cols = everything(), values_to = "data") %>%
  formattable::formattable(.,
                           list(
                             name = formattable::formatter("span", style = "color:#AAAAAA; font-size:4vw; font-weight:bold;border-color:#fff"),
                             data = formattable::formatter("span", style = "color:#AAAAAA;font-size:4vw;border-color:#fff")
                             # "span", style = ~ style("border-color: #fff !important")
                           )) #%>% formattable::as.htmlwidget(width = "20%")
```
```{r}
library(dplyr)
library(tidyr)
pool <- pool::dbPool(RSQLite::SQLite(), dbname = "data-raw/roasting_profiles.db")
filedb <- pool::dbReadTable(pool, "roast_profiles") %>% dplyr::filter(filename == "Dominican Republic--2021-02-25-17-09-27.json")

filedb %>% 
  select(-filename, -primary_key) %>% 
  mutate(`Weight loss` = ifelse(is.na(weight_before), 0, round((weight_before*100/weight_after),1))) %>% 
  mutate_if(is.integer, as.character) %>%
  mutate_if(is.double, as.character) %>%
  select(-weight_before, - weight_after) %>% 
  pivot_longer(cols = everything(), values_to = "data") %>%
 formattable::formattable(., align = c("l", "l"),
                          formattable::area(row=1:4) ~ formattable::formatter("table", style = "border-collapse: collapse; border:1px solid black;
    border-top: none;
    border-bottom: none;"),
                           list(
                             name = formattable::formatter("span", style = "color:#AAAAAA; font-size:14px; font-weight:bold;"),
                             data = formattable::formatter("span", style = "color:#AAAAAA;font-size:14px;border-color:#fff;")
                           ))

make_non_bold <- formattable::formatter("span", style =  "color:white;")
names(filedb_table) <- make_non_bold(names(filedb_table))
 
filedb %>% 
  select(-filename, -primary_key) %>% 
  mutate(`Weight loss` = ifelse(is.na(weight_before), 0, round((weight_before*100/weight_after),1))) %>% 
  mutate_if(is.integer, as.character) %>%
  mutate_if(is.double, as.character) %>%
  select(-weight_before, - weight_after) %>% 
  pivot_longer(cols = everything(), values_to = "data") %>% kableExtra::kbl()

gt_output()
render_gt()

filedb %>%
  select(-filename, -primary_key) %>%
  mutate(`Weight loss` = ifelse(is.na(weight_before), 0, round((
    weight_before * 100 / weight_after
  ), 1))) %>%
  mutate_if(is.integer, as.character) %>%
  mutate_if(is.double, as.character) %>%
  select(-weight_before, -weight_after) %>%
  pivot_longer(cols = everything(), values_to = "data") %>%
  gt::gt() %>%
  gt::tab_style(
    style = list(gt::cell_borders(
      sides = "all",
      color = "white",
      style = "solid",
      weight = gt::px(0)
    ),
    gt::cell_text(font = "Verdana", size = 10)),
    locations = gt::cells_body(columns = everything(),
                           rows = everything())) %>% 
      gt::tab_style(gt::cell_text(weight = "bold"), locations = gt::cells_body(columns = 1)) %>% 
  gt::tab_options(column_labels.hidden = TRUE, table_body.border.bottom.color= "white", table_body.border.top.color = "white")

```
```{r}
aroma <- c("Sweet","Stale","Grape","Blueberry")
library(sortable)
 sortable::bucket_list(
    header = "",
    group_name = "bucket_list_tasting",
    orientation = "vertical",
    sortable::add_rank_list(
      text = "",
      # labels = bucketlistlabels_tasting(),
      labels = aroma, # must be added one at a time
      css_id = "rank_list_tasting_css",
      input_id = "rank_list_tasting"
      # options = sortable::sortable_options(
      #   onLoad = htmlwidgets::JS("function (evt) {this.el.addChild(evt.item);}"),
      #   onSort = htmlwidgets::JS("function (evt) {this.el.addChild(evt.item);}")
      # )
    ),
    sortable::add_rank_list(
      text = "Drag to Remove",
      labels = NULL,
      input_id = "remove_tasting",
      options = sortable::sortable_options(
        onAdd = htmlwidgets::JS("function (evt) {this.el.removeChild(evt.item);}")
      )
    )
  )

```



